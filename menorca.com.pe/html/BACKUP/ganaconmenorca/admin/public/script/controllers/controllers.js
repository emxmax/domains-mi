// Generated by CoffeeScript 1.10.0
'use strict';
app.controller('LoginCrl', [
  '$scope', '$timeout', '$rootScope', '$location', 'AuthenticationService', function(scope, timeout, rootScope, location, AuthenticationService) {
    scope.datalogin = [];
    scope.datalogin = {};
    scope.error = "Los campos son obligatorios.";
    scope.validacion = function() {
      $("#form").validate({
        rules: {
          user: "required",
          password: "required"
        },
        errorLabelContainer: $("#form .form-error")
      });
    };
    scope.setup = function() {
      var $height;
      $height = $(window).height();
      $('body').css('height', $height + 'px');
    };
    AuthenticationService.ClearCredentials();
    scope.login = function() {
      if ($("#form").valid()) {
        scope.dataLoading = true;
        AuthenticationService.Login(scope.datalogin.user, scope.datalogin.password, function(response) {
          if (response.success) {
            AuthenticationService.SetCredentials(scope.datalogin.user, scope.datalogin.password, response.usercod, response.nameuser, response.miperfil, response.codperfil, response.firstname);
            location.path('/vista/principal');
          } else {
            console.log(response.message);
            scope.error = response.message;
            $("#form .form-error").fadeIn("slow");
            scope.dataLoading = false;
          }
        });
      }
    };
    timeout(scope.setup, 200);
    scope.validacion();
    window.addEventListener("resize", scope.setup);
  }
]);

app.controller('menuCrtl', [
  '$scope', '$timeout', '$location', '$rootScope', 'userModal', function(scope, timeout, location, rootScope, userModal) {
    scope.userName = rootScope.globals.currentUser.nameuser;
    scope.closeIntranet = function() {
      scope.$parent.$parent.boolmenu = false;
      location.path('/login');
    };
    scope.viewMenu = function(e) {
      $('.buttonInfo .main-info').toggle();
    };
    scope.viewMyuser = function() {
      userModal.activate();
    };
    scope.setup = function() {
      var $height;
      $height = $(window).height();
      $('.navMenu').css('height', $height + 'px');
    };
    scope.viewmainMenu = function() {
      if ($(".navMenu").hasClass('active')) {
        $(".navMenu").addClass('desactive').removeClass('active');
      } else {
        $(".navMenu").addClass('active').removeClass('desactive');
      }
    };
    timeout(scope.setup, 200);
    window.addEventListener("resize", scope.setup);
  }
]);

app.controller('usermodalCrtl', [
  '$scope', '$location', '$rootScope', '$http', 'userModal', function(scope, location, rootScope, http, userModal) {
    scope.currentTab = "./public/views/user/detalle.html";
    scope.usuario = [];
    scope.usuario = {};
    scope.usercod = rootScope.globals.currentUser.usercod;
    scope.closeModal = function() {
      userModal.deactivate();
    };
    scope.detalle = function() {
      var result, url;
      url = './controllers/user/detalle.php';
      result = http.post(url, {
        cod: scope.usercod
      });
      result.success(function(response) {
        console.log(response);
        scope.usuario = response;
      });
      result.error(function(error) {
        console.log(error);
      });
    };
    scope.saveUser = function(data) {
      var result, url;
      url = './controllers/user/saveform.php';
      result = http.post(url, {
        cod: scope.usercod,
        data: data
      });
      result.success(function(response) {
        scope.usuario = response;
        scope.detalle();
      });
      result.error(function(error) {
        console.log(error);
      });
    };
    scope.detalle();
  }
]);

app.controller('propietarioCrtl', [
  '$scope', '$location', '$cookieStore', '$http', 'propietarioModal', function(scope, location, cookieStore, http, propietarioModal) {
    scope.propietario = [];
    scope.propietario = {};
    scope.listado = function() {
      var result, url;
      url = './controllers/propietario/listar.php';
      result = http.post(url);
      result.success(function(response) {
        scope.propietario = response;
      });
      result.error(function(error) {
        console.log(error);
      });
    };
    scope.activarmenu = function() {
      $("#menu_2").addClass('active');
      $("#menu_1").removeClass('active');
    };
    scope.viewDetail = function(id) {
      cookieStore.put('codprop', id);
      propietarioModal.activate();
    };
    scope.clearData = function() {
      cookieStore.remove('codprop');
    };
    scope.propietariosExcel = function() {
      window.open('./excel/listpropietarios.php', '_blank');
    };
    scope.referidosExcel = function() {
      window.open('./excel/listrefridos.php', '_blank');
    };
    scope.excelMyReferido = function(id) {
      window.open('./excel/listrefridos.php?id=' + id, '_blank');
    };
    scope.clearData();
    scope.listado();
    scope.activarmenu();
  }
]);

app.controller('propietariomodalCrtl', [
  '$scope', '$location', '$cookieStore', '$http', 'propietarioModal', function(scope, location, cookieStore, http, propietarioModal) {
    scope.currentTab = "./public/views/propietario/detalle.html";
    scope.codprod = cookieStore.get('codprop');
    scope.propietario = [];
    scope.propietario = {};
    scope.referido = [];
    scope.referido = {};
    scope.closeModal = function() {
      scope.clearData();
      propietarioModal.deactivate();
    };
    scope.detalle = function() {
      var result, url;
      url = './controllers/propietario/detalle.php';
      result = http.post(url, {
        cod: scope.codprod
      });
      result.success(function(response) {
        scope.propietario = response;
      });
      result.error(function(error) {
        console.log(error);
      });
    };
    scope.listreferido = function() {
      var result, url;
      url = './controllers/propietario/referido.php';
      result = http.post(url, {
        cod: scope.codprod
      });
      result.success(function(response) {
        scope.referido = response;
        console.log(response);
      });
      result.error(function(error) {
        console.log(error);
      });
    };
    scope.irSeccion = function(seccion, e) {
      var idoption;
      idoption = $(e.currentTarget).data("id");
      console.log($("#option_" + idoption).hasClass("active"));
      if ($("#option_" + idoption).hasClass("active") === false) {
        $(".menuContacto li").removeClass("active");
        $("#option_" + idoption).addClass("active");
      }
      if ('referido' === seccion) {
        scope.listreferido();
      }
      scope.currentTab = "./public/views/propietario/" + seccion + ".html";
    };
    scope.clearData = function() {
      cookieStore.remove('codprop');
    };
    scope.detalle();
  }
]);

app.controller('usuarioCrtl', [
  '$scope', '$location', '$cookieStore', '$http', 'usergralModal', function(scope, location, cookieStore, http, usergralModal) {
    scope.usuario = [];
    scope.usuario = {};
    scope.activarmenu = function() {
      $("#menu_1").addClass('active');
      $("#menu_2").removeClass('active');
    };
    scope.listado = function() {
      var result, url;
      url = './controllers/user/listar.php';
      result = http.post(url);
      result.success(function(response) {
        console.log(response);
        scope.usuario = response;
      });
      result.error(function(error) {
        console.log(error);
      });
    };
    scope.viewDetail = function(id) {
      cookieStore.put('codprop', id);
      usergralModal.activate();
    };
    scope.clearData = function() {
      cookieStore.remove('codprop');
    };
    scope.clearData();
    scope.listado();
    scope.activarmenu();
  }
]);

app.controller('usergralmodalCrtl', [
  '$scope', '$location', '$rootScope', '$http', 'usergralModal', function(scope, location, rootScope, http, usergralModal) {
    scope.currentTab = "./public/views/user/detalle.html";
    scope.usuario = [];
    scope.usuario = {};
    scope.usercod = rootScope.globals.currentUser.usercod;
    scope.closeModal = function() {
      usergralModal.deactivate();
      window.location.assign("#vista/usuarios");
    };
    scope.detalle = function() {
      var result, url;
      url = './controllers/user/detalle.php';
      result = http.post(url, {
        cod: scope.usercod
      });
      result.success(function(response) {
        console.log(response);
        scope.usuario = response;
      });
      result.error(function(error) {
        console.log(error);
      });
    };
    scope.saveUser = function(data) {
      var result, url;
      url = './controllers/user/saveform.php';
      result = http.post(url, {
        cod: scope.usercod,
        data: data
      });
      result.success(function(response) {
        scope.usuario = response;
        scope.detalle();
      });
      result.error(function(error) {
        console.log(error);
      });
    };
    scope.detalle();
  }
]);
